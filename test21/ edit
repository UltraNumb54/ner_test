def advanced_preprocess_text(self, text):
    """Улучшенная предобработка текста с удалением стоп-слов и пунктуации"""
    if not text or not isinstance(text, str):
        return ""

    # Приведение к нижнему регистру
    text = text.lower()

    # Удаление всех меток, кроме [Показания]
    # Сначала сохраняем [Показания], потом удаляем все квадратные скобки, потом возвращаем [Показания]
    pokazaniya_matches = re.findall(r'\[Показания\]', text)
    text = re.sub(r'\[.*?\]', '', text)  # удаляем все в квадратных скобках
    
    # Замена пунктуации на пробелы (а не удаление)
    punctuation_chars = string.punctuation.replace('[', '').replace(']', '')  # исключаем квадратные скобки
    text = text.translate(str.maketrans(punctuation_chars, ' ' * len(punctuation_chars)))
    
    # Возвращаем [Показания] если они были
    for match in pokazaniya_matches:
        text = match + ' ' + text

    # Удаление лишних пробелов и нормализация
    text = re.sub(r'\s+', ' ', text).strip()

    # Удаление стоп-слов (убедимся, что это работает)
    words = text.split()
    filtered_words = []
    for word in words:
        # Проверяем, что слово не стоп-слово и длиннее 2 символов
        if word not in self.stop_words and len(word) > 2:
            filtered_words.append(word)
        # Также оставляем [Показания] если оно есть
        elif word == '[показания]':
            filtered_words.append(word)
    
    return ' '.join(filtered_words)